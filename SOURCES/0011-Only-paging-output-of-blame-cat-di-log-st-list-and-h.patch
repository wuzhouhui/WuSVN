From a901a34fcc84caee5ccae44c23aaeabc6b61bed2 Mon Sep 17 00:00:00 2001
From: wuzhouhui <wuzhouhui250@gmail.com>
Date: Sat, 17 Dec 2016 12:05:17 +0800
Subject: [PATCH 11/95] Only paging output of blame, cat, di, log, st, list,
 and help

---
 subversion/svn/svn.c | 26 +++++++++++++++++++++++---
 1 file changed, 23 insertions(+), 3 deletions(-)

diff --git a/subversion/svn/svn.c b/subversion/svn/svn.c
index 67da467..9d4b503 100644
--- a/subversion/svn/svn.c
+++ b/subversion/svn/svn.c
@@ -3320,9 +3320,25 @@ main(int argc, const char *argv[])
   apr_pool_t *pool;
   int exit_code = EXIT_SUCCESS;
   pid_t pid;
-  int fd[2];
+  int fd[2], needpipe = 0;
   svn_error_t *err;
 
+  if (argc >= 2) {
+    const svn_opt_subcommand_desc2_t *subcmd;
+    subcmd = svn_opt_get_canonical_subcommand2(svn_cl__cmd_table, argv[1]);
+    if (subcmd && subcmd->cmd_func == svn_cl__blame ||
+		    subcmd->cmd_func == svn_cl__cat ||
+		    subcmd->cmd_func == svn_cl__diff ||
+		    subcmd->cmd_func == svn_cl__log ||
+		    subcmd->cmd_func == svn_cl__status ||
+		    subcmd->cmd_func == svn_cl__list ||
+		    subcmd->cmd_func == svn_cl__help)
+      needpipe = 1;
+  }
+
+  if (!needpipe)
+    goto afterpipe;
+
   if (pipe(fd) < 0) {
     fprintf(stderr, "pipe failed\n");
     exit(EXIT_FAILURE);
@@ -3357,6 +3373,8 @@ main(int argc, const char *argv[])
     close(fd[1]);
   }
 
+afterpipe:
+
   /* Initialize the app. */
   if (svn_cmdline_init("svn", stderr) != EXIT_SUCCESS)
     return EXIT_FAILURE;
@@ -3378,8 +3396,10 @@ main(int argc, const char *argv[])
       svn_cmdline_handle_exit_error(err, NULL, "svn: ");
     }
 
-  close(STDOUT_FILENO);
-  waitpid(pid, NULL, 0);
+  if (needpipe) {
+    close(STDOUT_FILENO);
+    waitpid(pid, NULL, 0);
+  }
   svn_pool_destroy(pool);
 
   svn_cmdline__cancellation_exit();
-- 
1.8.3.1

